# Hula Swirl – Technische Dokumentation

## Verbaute Teile

- **Raspberry Pi 5** 
- **Motor Treiber** [Amazon](https://www.amazon.de/Hailege-DRV8871-Breakout-H-Bridge-6-5V-45V/dp/B0CJY3K2N3?dib=eyJ2IjoiMSJ9.fHwCsxxNFiKOW5h0oAJ-yboKxWwA-LNeeHDMCw9Xjm3fJyLySf-4_hfv1YzcTOERI_dRSUp0kKwz2NcRVyBq5wrKT_sI4fcV2HQUrBxU_KqaUSCmIoyG8hyQjY1acAS9gA1Sm5eCikBMBnSikrMV7GOIz4rUSm6ErtcF2RELX1Dkxti0OAEQPLb2B5bboXDHeauQBEBSKg3WlMoj85HsJqyyZNRDqcnMH36i1Bma-TGIB9LHx-3IbrNhw4scmBD-Q7IY_AnKA9x_uPeuGpa3WIi3hxPWip-EpowCU92ZbkQ.KD1v0VcVz33bVv9laouxdCeH1N4HfNPntHZZZCvammk&dib_tag=se&keywords=Motortreiber&qid=1730819376&sr=8-1-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&psc=1)
- **Usb Stepdown** (12V → 5V) [?]()
- **Clambs** [Amazon](https://www.amazon.de/-/en/Flintronic-Connectors-Actuation-Electrical-Connection/dp/B0BCNTVV4S?crid=3A2VIYI1QSS7Z&dib=eyJ2IjoiMSJ9.5EQ8zrESx451OzCIIRy8TynGNCOOU_tx5kUwW57W39fluXdRPrPP0f9UMO9k3e4VdSOlzl9TcVhBx1AwtOP5ZevuMXOBOZL_gD4RFGnX0ccMBFToECeX1zHkysg5lHoOx7xzxiVtn4nUQPEUeIIFyLax-Fnbb4eekQKGEzmLSbANhMBjuSTHugEnY4Ff7GfenpIukaHeJaSqtrRdbGDnYjC2QNWXqUBrE6RKQm3vRa_0bgcbWrMAIVA824JsThaz5mpfZWwGrQADgP9lRSYO5laykRqokroZzqjWNLgVca0.X8jhVTC-kOL7SmM2QrBLVj0YrzamKj5jYkA3vn__00U&dib_tag=se&keywords=connect+cable&qid=1730973101&sprefix=connect+cabl%2Caps%2C109&sr=8-9)
- **Wire** [Amazon](https://www.amazon.de/-/en/Silicone-Electric-Stranded-Electrical-Applications/dp/B0C7QTH8TC?crid=1KOPOHRL7HRBO&dib=eyJ2IjoiMSJ9.VN-g2lxkL868stgPOid0hK-Z35gETrYV7C5EdQnFRzCZPsqORFx4Z_SH0RIZNgQYu2g9FpvYaxyd_MPuPCVTQdhz6uTaWkiVfefgJlKxr4HNxHihUeOjAN50T7r3Gefnbucow4WWhrTsmZ2TixYfvY0uSpUlG7JzCKswtQBkrttnwUdIazaP57FE8hWmhzsscCl8KabjG1RCoePhFvPVkvQsKLcIAe5IiU7VmTSNhgLq85Q3f06uVFUIjoEhsyG2ioaEdXMOBR0fOzU-giWJTTrlyM35I8cGNH2FFfktH2o.yEOPCQuFURyct9ee-pa2RtkbTOGPW0ecgD_wWKWI_90&dib_tag=se&keywords=18%2BAWG%2Bwire&qid=1730973174&sprefix=18%2Bawg%2Bwir%2Caps%2C100&sr=8-18&th=1)
- **Powersupply** [Amazon](https://www.amazon.de/-/en/Adapter-100-240-Transformer-Monitor-Amplifier-Power-supply-12-V-3/dp/B0BP66JZLX?crid=2L6PFKLCEVK81&dib=eyJ2IjoiMSJ9._lkwspqmhU_fj9XvC2uB5Cll1bhHvjucTD1A1D93tQk0JwlyQ4i6_3KLH50N6DVbERmRfGBI-todPqX7FLL5o5m57lb4gFZdm8kdYJ72AwpwxX-6JuOLioxnVWqHmBiIfDy4Fyy2Cytbg1BVEG4vdmPcsibKb6P96-IsLemjw9XJiA0fi4SjBPL8Zhhijl2xy5fPbpkNvHEwu6iooqHzu_G1vLNEElQQjCUVDi00Y8c.mPqtxyoN5vhUvYyrQxUjrDtudTG9thY3_s2Dg8dyO-E&dib_tag=se&keywords=power+supply+3A&qid=1731005289&sprefix=power+supply+3a%2Caps%2C120&sr=8-3)
- **breadboard + jumperwire** [Amazon](https://www.amazon.de/-/en/HUAREW-Breadboard-Dupont-Points-Arduino/dp/B0B5TCKTQH?crid=2H1V44Q263MD5&dib=eyJ2IjoiMSJ9.aRQeJMI5vdGBirt5tCbbkvFrQGta46bFt4TW95QpKEI_qHNschVOZrDLg2LZDJJZQAXxyh-2uU9z9h8oMATldodApJRJ3Aw0v33jJoYkZPAIOUjT6Rn-n3cJCxTrRwhqyIvsNW9NoxCx8P_a7BCcYzp2_8deppQsQIBABuIQxDvttl7ca73gW1j-YaZYmrjlH1v6Ai5UeNeYgtCnwP9a1o27a4E_BofieoY3sTTA0scZIUI-Q_9jp4Pp4yylzZ1g0V7kDiI2c-HRnldF07111cC90ts6DsUeTzG2M4DqR58.GKKUBGBXDt9iH5LYVhwsJuKDZRnn8kGujHwg4HpLXqc&dib_tag=se&keywords=steckplatine&qid=1730977442&sprefix=steckplatine%2Caps%2C145&sr=8-15)
- **pumps** [Amazon](https://www.amazon.de/RUNCCI-YUN-Wasserk%C3%BChlpumpe-selbstansaugend-Membranpumpe-Wasserspender/dp/B0CB3QGFX2?__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&crid=1MUZ9G0RXC5SO&dib=eyJ2IjoiMSJ9.bqGrRL28UVxEQ38fHLKBORYxd8EPZASb0yRdJA1aNGiJJ9wfDPNNoZ_SgJz8X4pcG0Bci5M6c_NDnlUmi1U0KWRJy8eOcGLER0lXsbMVKqevkEBMUL3tPtnackTJQClTgXHMLqkq6J_bNgrllMp3lB5iYyVFHq5uYmbdTTX4fvO2g9G4doc9aWJl7AjoYzoi2d0mtYzCqP5N2HO_3zHhHvaFbAX-ADVjzSJ13TlTCOD2gqqSHDdfiLikfMAvql8La2WGZ2wzf1PDYdh9KTFLeaXNuBuXAoyN9z3Kz3I64zA.lsTtgrFd7Nv_5HquAgGhWpuLfEnSxKHFPx2eeJfAz-w&dib_tag=se&keywords=12V+waterpump+small&nsdOptOutParam=true&qid=1732231751&sprefix=12v+waterpump+small%2Caps%2C104&sr=8-5)
- **wire usb-a to usb-c** [??]()
- **Tubes** [Amazon](https://www.amazon.de/dp/B0D1XYBLC1?ref=ppx_yo2ov_dt_b_fed_asin_title)



## Aufbauanleitung („Kochrezept“)

1. **Raspberry Pi vorbereiten**
   - Raspberry Pi OS installieren(über sd karte)
    - ssh verbindung mit rasberry herstellen
   - Dotnet 9 installieren
   - EF tools installieren

2. **Gerät bauen**
    - schläuche an pumpen stecken
    - lankabel an den rasperri pi anschliesen
    - raberry pi mit strom versorgen (UBB C)
    - USB Stepdown
    - **Pumpe mit den mitgelieferten Kabeln verbinden**
    - Rot an + (Plus)
    - Schwarz an – (Minus)  
        → Diese zwei Kabel gehen zur **H-Brücke (DRV8871)**.

    - **Die Pumpe wird an den DRV8871 angeschlossen:**
    - Rotes Pumpenkabel → **Motor +** am DRV8871
    - Schwarzes Pumpenkabel → **Motor –** am DRV8871

    - **Der DRV8871 bekommt Strom vom Netzteil:**
    - **Supply + (VCC)** → 12 V Plus vom Netzteil
    - **Supply – (GND)** → GND vom Netzteil

    - **Die Steuerung erfolgt über den Raspberry Pi:**
    - Jeder DRV8871 braucht 3 Leitungen vom Pi:
        - **IN1**
        - **IN2**
        - **GND** (Signalmasse!)
    - GPIO-Zuordnung:
        - **Pumpe 1:**
        - GPIO 23 → IN1
        - GPIO 24 → IN2
        - GND vom Pi → GND vom DRV8871
        - **Pumpe 2:**
        - GPIO 17 → IN1
        - GPIO 27 → IN2
        - GND vom Pi → GND vom DRV8871 (gemeinsam mit erster Brücke möglich)
            - **Die Pumpe bekommt Strom, sobald der DRV8871 durch den Raspberry Pi aktiviert wird.**

## Was passiert bei einem API-Request?

- **1. Die Web-App sendet einen POST-Request**
  - Endpoint z. B.: `POST /order/{drinkId}`
  - Wird über Angular ausgelöst (z. B. durch Klick auf „Getränk starten“)

- **2. Backend verarbeitet den Request**
  - Das .NET-Minimal-API Backend empfängt die `drinkId` und prüft:
    - Gibt es dieses Getränk?
    - Welche Zutaten (mit Mengen) werden benötigt?
    - Sind genug Zutaten vorhanden (`RemainingAmount`)?

- **3. Zutatensteuerung über GPIO**
  - Für jede Zutat:
    - Bestimme die zugehörige Pumpe via `PumpSlot`
    - Berechne, wie lange die Pumpe laufen muss (z. B. 10 ml = 1 s)
    - Schalte die Pumpe über den entsprechenden **GPIO-Pin-Paar**:
      - `GPIO A` = High
      - `GPIO B` = Low
    - Warte die berechnete Zeit
    - Schalte wieder ab (`beide GPIO auf Low`)
    - Aktualisiere `RemainingAmount`

- **4. Logging & Statistik**
  - Speichere die Bestellung in `DrinkOrder`
  - Erhöhe Zähler in `UserDrinkStatistic`
  - Rückgabe an die App: `200 OK`

---

## Wichtige Hinweise zur Sicherheit

- **Alle GND-Leitungen verbinden**  
  → Ohne gemeinsame Masse (Netzteil ↔ Raspberry Pi) kann es zu Fehlfunktionen oder Schäden kommen.

- **Pumpen nie trocken laufen lassen**  
  → Sonst riskierst du Hitzeschäden. Fülle die Schläuche vorher mit Wasser oder der Flüssigkeit.

- **GPIO-Pins nie direkt mit 12 V verbinden**  
  → Raspberry Pi GPIOs arbeiten mit 3.3 V. Mehr zerstört den Chip.

- **Vor dem Testen prüfen:**
  - Pumpe korrekt gepolt?
  - 12 V Spannung vorhanden?
  - USB Stepdown korrekt angeschlossen?
  - DRV8871 ordentlich verschraubt?

- **Verbindungen sichern**
  - Benutze Schraubklemmen, Lötstellen oder Wagos – lose Kabel können Kurzschlüsse verursachen.

- **Netzteil niemals kurzschließen**
  - Immer zuerst GND anschließen, dann Plus. Teste mit Multimeter.